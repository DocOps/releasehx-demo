$config:
  path_lang: jmespath
  tplt_lang: liquid
  desc: GitLab Issues API to RHYML (API testing with release notes)
  note: Extracts release notes from ## Release Note sections in issue body

changes_array_path: "[?state == 'closed']"

tick:
  path: iid

type:
  path: labels[0].name
  tplt: '{{ path | default: "task" }}'

parts:
  path: labels[].name
  tplt: '{{ path | join: "," }}'

# hash: GitHub Issues API doesn't provide merge commit info directly

summ:
  path: title

head:
  path: title

note:
  path: body
  tplt: |
    {% assign lines = path | split: "\n" %}
    {% assign in_release_note = false %}
    {% assign note_lines = "" | split: "\n" %}
    {% for line in lines %}
      {% if line contains "## Release Note" %}
        {% assign in_release_note = true %}
        {% continue %}
      {% endif %}
      {% if in_release_note %}
        {% if line contains "##" and line != "## Release Note" %}
          {% break %}
        {% endif %}
        {% unless line == "" and note_lines.size == 0 %}
          {% assign note_lines = note_lines | push: line %}
        {% endunless %}
      {% endif %}
    {% endfor %}
    {{ note_lines | join: "\n" | strip }}

tags:
  path: labels[].name

lead:
  path: assignees[0].username
